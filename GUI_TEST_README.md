# ROS Client GUI 测试工具使用说明

## 功能概述

这是一个用于测试 RosClient 的图形界面工具，提供以下功能：

1. **连接配置** - 连接/断开 ROS Bridge
2. **状态监控** - 实时显示无人机状态信息
3. **图像显示** - 显示相机图像（支持自动/手动更新）
4. **点云显示** - 显示3D点云数据
5. **控制命令** - 发送ROS Topic控制命令
6. **网络测试** - 测试ROS设备网络连接

## 安装依赖

### 必需依赖
```bash
pip install rosclient  # 或从源码安装
```

### 可选依赖（用于图像和点云显示）
```bash
pip install opencv-python Pillow matplotlib numpy
```

## 运行方式

```bash
python rosclient_gui_test.py
```

## 使用说明

### 1. 连接配置

- **WebSocket地址**: 输入ROS Bridge的WebSocket地址，例如 `ws://localhost:9090`
- **使用Mock客户端**: 勾选此选项可使用Mock客户端进行测试（无需实际ROS连接）
- **连接/断开按钮**: 建立或断开与ROS Bridge的连接

### 2. 状态监控

显示无人机的实时状态信息，包括：
- 连接状态、解锁状态、飞行模式
- 电池电量
- GPS位置（纬度、经度、高度）
- 姿态角（横滚、俯仰、偏航）
- 飞行状态（着陆、到达目标、返航、起飞）

点击"刷新状态"按钮可手动更新状态。

### 3. 图像显示

- **自动更新**: 勾选后自动从相机Topic获取最新图像
- **手动获取**: 点击按钮手动获取一次图像
- 图像会自动缩放以适应显示区域

**注意**: 需要安装 `opencv-python` 和 `Pillow` 才能显示图像。

### 4. 点云显示

- **自动更新**: 勾选后自动从点云Topic获取最新数据
- **手动获取**: 点击按钮手动获取一次点云
- 点云以3D散点图形式显示，颜色表示Z轴高度

**注意**: 需要安装 `matplotlib` 和 `numpy` 才能显示点云。

### 5. 控制命令

#### Topic配置
- **Topic名称**: 要发布的Topic名称，例如 `/control`
- **Topic类型**: Topic的消息类型，例如 `controller_msgs/cmd`

#### 消息编辑
- 在文本框中输入JSON格式的消息内容
- 可以使用预设命令快速填充：
  - 起飞: `{"cmd": 1}`
  - 降落: `{"cmd": 2}`
  - 返航: `{"cmd": 3}`
  - 悬停: `{"cmd": 4}`

#### 发送命令
- 点击"发送命令"按钮发送消息
- 发送的命令会记录在"命令历史"中

### 6. 网络测试

#### 测试连接
- 输入要测试的WebSocket地址
- 设置超时时间（秒）
- 点击"测试连接"按钮测试连接是否成功

#### 测试Topic
- 测试常见Topic的可用性
- 需要先连接到ROS才能使用

#### 完整测试
- 执行完整的网络测试，包括：
  1. 连接测试
  2. 状态获取测试
  3. 消息发布测试

## 使用示例

### 示例1: 使用Mock客户端测试

1. 打开GUI工具
2. 在"连接配置"标签页中：
   - 输入任意地址（例如 `ws://localhost:9090`）
   - 勾选"使用Mock客户端（测试模式）"
   - 点击"连接"
3. 切换到"状态监控"标签页查看状态
4. 切换到"控制命令"标签页发送测试命令

### 示例2: 连接真实ROS设备

1. 确保ROS Bridge正在运行
2. 在"连接配置"标签页中：
   - 输入ROS Bridge地址（例如 `ws://192.168.1.100:9090`）
   - 不勾选Mock选项
   - 点击"连接"
3. 等待连接成功后，可以：
   - 查看实时状态
   - 查看相机图像
   - 查看点云数据
   - 发送控制命令

### 示例3: 发送自定义控制命令

1. 连接到ROS
2. 切换到"控制命令"标签页
3. 配置Topic名称和类型
4. 在消息编辑器中输入JSON消息，例如：
   ```json
   {
       "drone_id": 1,
       "goal": [10.0, 20.0, 5.0]
   }
   ```
5. 点击"发送命令"

## 故障排除

### 连接失败
- 检查WebSocket地址是否正确
- 确认ROS Bridge服务正在运行
- 检查网络连接和防火墙设置
- 查看"连接状态"标签页中的错误信息

### 图像不显示
- 确认已安装 `opencv-python` 和 `Pillow`
- 检查相机Topic是否正在发布数据
- 尝试使用"手动获取"按钮

### 点云不显示
- 确认已安装 `matplotlib` 和 `numpy`
- 检查点云Topic是否正在发布数据
- 确认点云数据格式正确

### 命令发送失败
- 确认已连接到ROS
- 检查Topic名称和类型是否正确
- 确认消息格式为有效的JSON
- 查看"连接状态"标签页中的错误信息

## 注意事项

1. **线程安全**: GUI使用多线程更新，确保在连接状态下操作
2. **资源占用**: 自动更新功能会持续占用资源，不需要时可关闭
3. **网络延迟**: 网络延迟可能影响实时性，特别是在远程连接时
4. **数据格式**: 确保发送的消息格式符合ROS消息类型定义

## 技术细节

- **GUI框架**: tkinter (Python标准库)
- **图像处理**: OpenCV + PIL
- **3D可视化**: Matplotlib
- **异步更新**: 多线程 + 定时器
- **消息格式**: JSON

## 许可证

与主项目相同。

